ココにイル  設計書

■機能概要
  スマホ等のモバイル機器でマップを表示し、グループ設定されたメンバーの位置情報をマップ上へ
  リアルタイムに表示する。


■ユースケース
①アプリを起動する。
②新規の部屋に入室する。
③使用中の部屋に入室する。
④部屋から退出する。
⑤マップを表示する。
⑥アプリを終了する。


■画面一覧
①トップ画面
②ルーム選択ダイアログ
③エラー表示ダイアログ
④マップ画面


■画面項目
1.トップ画面
  部屋選択ボタン      部屋番号ラベル
  パスワードラベル    パスワード入力
  ニックネームラベル  ニックネーム入力
  入室ボタン  退出ボタン  クリアボタン

2.部屋選択ダイアログ
  部屋リスト

3.マップ画面
  トップ画面ボタン  追従トグルボタン
  マップ表示

■処理詳細
1.トップ画面
(1)起動時
①ユーザIDとして端末のMACアドレスを設定する。

②設定値を読込む。
  設定値から入室済みかを判断する。
  入室済みの場合、設定値を部屋番号ラベル、パスワード入力、ニックネーム入力に設定する。
  部屋選択ボタン、パスワード入力、ニックネーム入力を無効にする。
  入室ボタン、退出ボタンを有効にする。

③未入室の場合、部屋データ取得サーブレットにGETリクエストする。

④リクエスト結果が正常の場合、レスポンスから部屋データを取得する。

⑤リクエスト結果が異常の場合、エラー内容をエラー表示ダイアログに表示する。
  エラー表示ダイアログ終了後、アプリを終了する。

(2)部屋選択ボタン押下
①以下のパラメータを設定し部屋選択ダイアログを表示する。
  パラメータ
    部屋番号
    使用中フラグ
    所有者ニックネーム

②部屋選択ダイアログで部屋番号、所有者ニックネームの部屋データリストを表示する。

③部屋データリストをクリックした場合、選択した部屋番号をトップ画面に返却しダイアログを閉じる。

(3)入室ボタン押下
①部屋番号、パスワード、ニックネームの入力値を取得する。

②入室済みの場合、⑤の処理へ

③未入室かつ全てが入力されていない場合、警告メッセージを表示する。

④未入室かつ全てが入力されている場合、以下のパラメータを設定し入室サーブレットへPOSTリクエストする。
  パラメータ
    ユーザID
    部屋番号
    パスワード
    ニックネーム

⑤リクエスト結果が正常の場合、以下を設定ファイルに保存する。
  ユーザID
  部屋番号
  パスワード
  ニックネーム

⑥上記をパラメータに設定してマップ画面を表示する。

⑦リクエスト結果が異常の場合、エラー内容をエラー表示ダイアログに表示する。

(4)退出ボタン押下時
①以下をパラメータに設定して退出サーブレットへPOSTリクエストする。
  パラメータ
    ユーザID
    部屋番号

②リクエスト結果が正常の場合、以下の設定を行う。

(5)クリアボタン押下時
  部屋番号ラベル、パスワード入力、ニックネーム入力をクリアする。

2.部屋選択ダイアログ
(1)起動時

(2)部屋リストクリック


初期サーブレット(InitServlet)
  リクエストからパラメータを取得する。
    ユーザID

■入室サーブレット(EnterServlet)
  1.リクエストからパラメータを取得する。
    ユーザID
    部屋番号
    パスワード
    ニックネーム
  2.部屋番号で使用データを検索する。
  3.部屋番号で部屋データを検索する。
  4.使用データがある場合、部屋データのパスワードと一致するか確認する。
    一致する場合、OKを返却する。
    一致しない場合、NGを返却する。
  5.使用データが無い場合、部屋データ、使用データにデータを登録する。
    OKを返却する。

■退出サーブレット(ExitServlet)


位置情報設定サーブレット(SetLocaitonServlet)

部屋データ
  部屋番号(ID)
  使用中フラグ
  パスワード
  所有者ID(ユーザーID)
  所有者ニックネーム
  登録日時

位置情報データ
  ID(ユーザID)
  部屋番号
  ニックネーム
  経度
  緯度
  更新日時

以上
